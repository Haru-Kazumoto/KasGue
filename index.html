<!doctype html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>KasGue | Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
</head>

<body class="bg-gray-50 text-gray-800" id="app">
    <!-- Container -->
    <div class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <!-- Card -->
        <div
            class="w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">

            <!-- Left: Login form -->
            <div class="p-6 sm:p-10">
                <form class="space-y-6" @submit.prevent="onSubmit">
                    <div class="mb-6">
                        <!-- Branding -->
                        <div class="flex flex-col">
                            <div class="flex items-baseline gap-2">
                                <span class="text-2xl font-bold text-gray-800">
                                    Kas<span class="text-red-500 font-bold">Gue</span>
                                </span>
                                <span class="text-sm text-gray-500 tracking-wide">by Manajemen Informatika</span>
                            </div>
                        </div>

                        <!-- Separator -->
                        <div class="mt-3 border-t-2 border-gray-200"></div>

                        <!-- Section Title -->
                        <div class="pt-4">
                            <h1 class="text-xl font-semibold text-gray-900">Masuk ke akun Anda</h1>
                            <p class="mt-1 text-sm text-gray-500">
                                Gunakan username dan kata sandi yang terdaftar untuk melanjutkan.
                            </p>
                        </div>
                    </div>

                    <div>
                        <label for="username" class="block mb-2 text-sm font-medium text-gray-900">Username</label>
                        <input type="text" id="username" name="username" v-model.trim="form.username" required
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block w-full px-3 py-2.5"
                            placeholder="laba_laba_sunda" />
                    </div>

                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label for="password" class="text-sm font-medium text-gray-900">Password</label>
                        </div>
                        <input type="password" id="password" name="password" v-model="form.password" required
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block w-full px-3 py-2.5"
                            placeholder="••••••••" />
                    </div>

                    <button type="submit" :disabled="loading"
                        class="w-full inline-flex items-center justify-center rounded-lg bg-red-600 hover:bg-red-700 disabled:opacity-60 disabled:cursor-not-allowed focus:ring-4 focus:ring-red-300 text-white text-sm font-medium px-5 py-2.5">
                        <span v-if="!loading">Masuk</span>
                        <span v-else>Sabar bro lagi proses...</span>
                    </button>

                    <!-- Area menampilkan hasil / error -->
                    <div v-if="error" class="text-sm text-red-600 bg-red-50 border border-red-200 rounded-md p-3">
                        {{ error }}
                    </div>
                    <div v-if="response" class="text-sm text-blue-600 bg-blue-50 border border-blue-200 rounded-md p-3">
                        {{ response }}</div>

                    <p class="text-sm text-gray-600">
                        Stalk the
                        <a href="https://haru-kazumoto.github.io/ziaurrahman/" target="_blank"
                            class="text-red-700 hover:underline">Developer</a>
                    </p>
                </form>
            </div>


            <!-- Right: Image (only visible on md and up) -->
            <div class="relative min-h-full hidden md:block">
                <img src="images/login_ornamen.png" alt="Ornamen login"
                    class="absolute inset-0 w-full h-full object-cover" loading="lazy" />
            </div>


        </div>
    </div>



    <!-- Vue 3 CDN (global build) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <script>
        const { createApp, ref } = Vue

        createApp({
            setup() {
                const form = ref({
                    username: '',
                    password: '',
                })
                const loading = ref(false)
                const error = ref('')
                const response = ref('')
                const API_BASE = "https://kasgue-backend-production.up.railway.app/api/v1"
                // const API_BASE = "http://localhost:3000/api/v1"

                const onSubmit = async () => {
                    error.value = ''
                    response.value = ''
                    loading.value = true
                    try {
                        const res = await fetch(`${API_BASE}/auth/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                // Tambahkan Authorization kalau perlu:
                                // 'Authorization': 'Bearer <token>'
                            },
                            body: JSON.stringify({
                                username: form.value.username,
                                password: form.value.password,
                            }),
                            // Kalau butuh cookie/session dari backend:
                            credentials: 'include',
                        })

                        // Ambil konten (bisa JSON atau text)
                        const contentType = res.headers.get('content-type') || ''
                        const data = contentType.includes('application/json')
                            ? await res.json()
                            : await res.text()

                        if (!res.ok) {
                            throw new Error(typeof data === 'string' ? data : (data.message || 'Login gagal'))
                        }

                        response.value = typeof data === 'string' ? data : "Berhasil Masuk, sabar gw ganti halaman dulu"

                        const user = data.user;

                        if (data && data.user) {
                            localStorage.setItem('user_data', JSON.stringify({
                                username: user.username,
                                email: user.email,
                                fullname: user.fullname,
                                major_name: user.major_name,
                                major_code: user.major_code
                            }));
                        }

                        setInterval(() => {
                            window.location.href = "dashboard.html";
                        }, 1700);
                    } catch (e) {
                        error.value = e?.message || 'Terjadi kesalahan jaringan'
                    } finally {
                        loading.value = false
                    }
                }

                return { form, loading, error, response, onSubmit }
            }
        }).mount('#app')
    </script>

</body>

</html>